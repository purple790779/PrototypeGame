<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Spectral Project (Flat)</title>

  <style>
    html, body { margin:0; padding:0; height:100%; overflow:hidden; background:#000; touch-action:none; }
    #app { position: fixed; inset: 0; }
    #hud { position: fixed; inset: 0; pointer-events: none; z-index: 10; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }

    .btn{
      pointer-events:auto;
      background: rgba(0,0,0,.55);
      color:#fff;
      border:1px solid rgba(255,255,255,.85);
      padding:10px 14px;
      cursor:pointer;
      border-radius:10px;
      font-size:18px;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }
    #start-btn {
      position:absolute;
      bottom: calc(110px + env(safe-area-inset-bottom));
      right: calc(20px + env(safe-area-inset-right));
    }

    #debug {
      position:absolute;
      left: calc(12px + env(safe-area-inset-left));
      bottom: calc(18px + env(safe-area-inset-bottom));
      color:#fff; font:12px/1.3 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      opacity:.95; pointer-events:none; white-space:pre-wrap;
      max-width: 92vw;
    }
    #banner {
      position:absolute;
      left: calc(12px + env(safe-area-inset-left));
      top: calc(12px + env(safe-area-inset-top));
      background: rgba(255,70,70,.12);
      border: 1px solid rgba(255,70,70,.35);
      color: rgba(255,230,230,.95);
      padding: 10px 12px;
      border-radius: 12px;
      pointer-events:none;
      display:none;
      max-width: 92vw;
      white-space:pre-wrap;
      font: 13px/1.35 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }

    .hud-side {
      position:absolute;
      top: calc(16px + env(safe-area-inset-top));
      bottom: calc(140px + env(safe-area-inset-bottom));
      width: clamp(180px, 20vw, 260px);
      display:flex;
      flex-direction:column;
      gap: 12px;
    }
    #left-hud { left: calc(16px + env(safe-area-inset-left)); }
    #right-hud { right: calc(16px + env(safe-area-inset-right)); text-align: right; }

    .hud-title {
      color: rgba(255,255,255,.92);
      font-size: 14px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      text-shadow: 0 2px 8px rgba(0,0,0,.45);
    }
    .hud-panel {
      background: rgba(10,12,20,.45);
      border: 1px solid rgba(255,255,255,.22);
      border-radius: 14px;
      padding: 12px;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      color: #eef2ff;
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
    }
    .commander-card {
      display:flex;
      align-items:center;
      gap: 10px;
    }
    #right-hud .commander-card { flex-direction: row-reverse; }
    .commander-portrait {
      width: 52px;
      height: 52px;
      border-radius: 10px;
      background: linear-gradient(135deg, rgba(255,255,255,.2), rgba(255,255,255,.05));
      border: 1px solid rgba(255,255,255,.4);
      flex-shrink: 0;
    }
    .commander-name {
      font-weight: 700;
      font-size: 15px;
    }
    .commander-role {
      font-size: 12px;
      opacity: .75;
      margin-top: 2px;
    }
    .formation-list {
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .formation-card {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 8px;
      font-size: 12px;
    }
    #right-hud .formation-card { flex-direction: row-reverse; text-align: right; }
    .formation-name {
      font-weight: 600;
    }
    .formation-meta {
      font-size: 11px;
      opacity: .8;
    }
    .formation-status {
      font-size: 10px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: rgba(255,255,255,.75);
    }

    #bottom-hp {
      position:absolute;
      left: 50%;
      bottom: calc(18px + env(safe-area-inset-bottom));
      transform: translateX(-50%);
      width: min(78vw, 640px);
      display:flex;
      align-items:stretch;
      justify-content:space-between;
      gap: 12px;
      pointer-events: none;
    }
    .hp-panel {
      flex: 1;
      background: rgba(8,10,16,.55);
      border: 1px solid rgba(255,255,255,.25);
      border-radius: 14px;
      padding: 10px 12px;
      display:flex;
      flex-direction:column;
      gap: 8px;
      color: #fff;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }
    .hp-header {
      display:flex;
      justify-content:space-between;
      font-size: 12px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      opacity: .85;
    }
    .hp-meter {
      position:relative;
      height: 10px;
      background: rgba(255,255,255,.12);
      border-radius: 999px;
      overflow:hidden;
    }
    .hp-fill {
      position:absolute;
      inset:0;
      width: 100%;
      border-radius: 999px;
      transition: width .3s ease;
    }
    .hp-panel.ally .hp-fill { background: linear-gradient(90deg, #5bb6ff, #1f5dff); }
    .hp-panel.enemy .hp-fill { background: linear-gradient(270deg, #ff9b9b, #ff3b3b); }
    .hp-values {
      display:flex;
      justify-content:space-between;
      font-size: 12px;
      opacity: .9;
    }
  </style>
</head>

<body>
  <div id="app"></div>

  <div id="hud">
    <div id="left-hud" class="hud-side">
      <div class="hud-title">아군 지휘관</div>
      <div class="hud-panel commander-card">
        <div class="commander-portrait"></div>
        <div>
          <div id="ally-commander-name" class="commander-name">아르센 리버스</div>
          <div class="commander-role">Frontline Commander</div>
        </div>
      </div>
      <div id="ally-formations" class="hud-panel formation-list"></div>
    </div>

    <div id="right-hud" class="hud-side">
      <div class="hud-title">적군 지휘관</div>
      <div class="hud-panel commander-card">
        <div class="commander-portrait"></div>
        <div>
          <div id="enemy-commander-name" class="commander-name">이블 나이트</div>
          <div class="commander-role">Rogue Commander</div>
        </div>
      </div>
      <div id="enemy-formations" class="hud-panel formation-list"></div>
    </div>

    <div id="bottom-hp">
      <div class="hp-panel ally">
        <div class="hp-header">
          <span>아군 HP</span>
          <span id="ally-hp-percent">100%</span>
        </div>
        <div class="hp-meter">
          <div id="ally-hp-fill" class="hp-fill"></div>
        </div>
        <div class="hp-values">
          <span id="ally-hp-count">0/0</span>
          <span id="ally-hp-status">READY</span>
        </div>
      </div>
      <div class="hp-panel enemy">
        <div class="hp-header">
          <span>적군 HP</span>
          <span id="enemy-hp-percent">100%</span>
        </div>
        <div class="hp-meter">
          <div id="enemy-hp-fill" class="hp-fill"></div>
        </div>
        <div class="hp-values">
          <span id="enemy-hp-count">0/0</span>
          <span id="enemy-hp-status">READY</span>
        </div>
      </div>
    </div>
    <button id="start-btn" class="btn">전투 시작 (Battle Start)</button>
    <div id="banner"></div>
    <div id="debug">loading...</div>
  </div>

  <script>
    (function () {
      const debugEl = document.getElementById('debug');
      const bannerEl = document.getElementById('banner');
      const setDebug = (m) => { if (debugEl) debugEl.textContent = m; };
      const showBanner = (m) => {
        if (!bannerEl) return;
        bannerEl.style.display = 'block';
        bannerEl.textContent = m;
      };

      // ✅ file://로 열면 거의 100% 여기 걸림
      if (location.protocol === 'file:') {
        showBanner(
          '⚠️ file://로 열면 모듈(ESM) 로딩이 막혀서 검은 화면이 나올 수 있어요.\n' +
          '✅ 해결: Live Server 또는 python -m http.server로 실행하세요.\n' +
          '예) http://localhost:8000/docs/spectral_project/'
        );
      }

      window.addEventListener('error', (e) => {
        setDebug('ERROR ❌\n' + (e?.message || e));
      });

      window.addEventListener('unhandledrejection', (e) => {
        setDebug('PROMISE ERROR ❌\n' + (e?.reason?.message || e?.reason || e));
      });
    })();
  </script>

  <script type="module" src="./src/main.js"></script>
</body>
</html>
